<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bencrypt JS Test (USAG-Lib)</title>
    <script src="https://cdn.jsdelivr.net/npm/js-sha3@0.9.3/src/sha3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/argon2-browser@1.18.0/dist/argon2-bundled.min.js"></script>
    <script src="../Bencrypt.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background-color: #f0f0f0; }
        #console { 
            background-color: #1e1e1e; 
            color: #d4d4d4; 
            padding: 15px; 
            border-radius: 5px; 
            white-space: pre-wrap; 
            min-height: 300px;
            overflow-y: auto;
        }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        .success { color: #4caf50; }
        .info { color: #569cd6; }
        .warn { color: #cca700; }
        .error { color: #f44336; }
    </style>
</head>
<body>

    <h1>Bencrypt.js Library Test</h1>
    <p>Tests USAG-Lib Bencrypt implementation matching Python logic.</p>
    <button onclick="runTest()">(Run Test)</button>
    <br><br>
    <div id="console">Ready...</div>

    <script>
        // printer
        const consoleDiv = document.getElementById('console');
        function log(message, color = '') {
            const span = document.createElement('span');
            span.textContent = message + "\n";
            if (color) span.style.color = color;
            consoleDiv.appendChild(span);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message);
        }

        // Uint8Array to hex string (helper)
        function formatBytes(u8) {
            if (u8.length > 100) return `[Uint8Array length=${u8.length}]`;
            try {
                return `${Array.from(u8).map(b => b.toString()).join(' ')}`;
            } catch (e) {
                return "[Error formatting bytes]";
            }
        }

        // base64 to Uint8Array
        function fromBase64(str) {
            return Uint8Array.from(atob(str), c => c.charCodeAt(0));
        }

        async function runTest() {
            consoleDiv.innerHTML = "";
            log("--- Start Bencrypt.js Test (Browser) ---", "#569cd6");

            let pub0 = 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA36kLQ7+w1kCw1S1b6T1ikSZ5S/m/QX5tPQkiasibLWyKKr113TUIGEn6hjY0mmy8w5WLgiP144ib8/D07OXSyxwv5NYMW8B3BJCgYcj2c5Zr7b3yjwLAI/dWOWof9ZoJpqF/0BrEyYDtdcnV6p5qTYS37EV6SsCCAIa1DT3pnDrT/vn5VbXLFYVqJAdxePvDKkAfAEwKvKDo4Etd7WSN8oXsDOgFCTrW7L5iWwfrlr21tX5FqIG1uKjlrb5kY0omfc2RqZo5a/3LfUEwrRrw/Bj3T7iIg43mmfdeRxEH9KJzEjjeNwzvjBBBd/cg63bpz7KyxnNp3jXGZQ9QAYp6vwIDAQAB'
            let pri0 = 'MIIEpQIBAAKCAQEA36kLQ7+w1kCw1S1b6T1ikSZ5S/m/QX5tPQkiasibLWyKKr113TUIGEn6hjY0mmy8w5WLgiP144ib8/D07OXSyxwv5NYMW8B3BJCgYcj2c5Zr7b3yjwLAI/dWOWof9ZoJpqF/0BrEyYDtdcnV6p5qTYS37EV6SsCCAIa1DT3pnDrT/vn5VbXLFYVqJAdxePvDKkAfAEwKvKDo4Etd7WSN8oXsDOgFCTrW7L5iWwfrlr21tX5FqIG1uKjlrb5kY0omfc2RqZo5a/3LfUEwrRrw/Bj3T7iIg43mmfdeRxEH9KJzEjjeNwzvjBBBd/cg63bpz7KyxnNp3jXGZQ9QAYp6vwIDAQABAoIBAG3GlCtT/jEivkhbg4WmpebVSeqy8Z7tNSOkhJqBzLxOTkBtDlkc6tS1FrviBg6XeUzL7RXanZjol5bzONu/b6dWNeGs95LfE+uPKtDj6KbR+TZOqSttL65XeyAiCP6sdLkvAkM7qEO4vpQ2FQMbbtSOZBGZBk2DUCt+8oVF0o/lWsRu3mvhm5sh38s3OEVw2XI/+lARF5g0jyzn9uAu0DS3m9E9L9IIOaN6R//l47sKnRM4PynRx+XlcbdksLTvkRJMIJpiovoaV1IzSNBBuSwsu8Sd25T0jQRIkJRAGsUfqqk03ZkM/jFAyugJyeJAFQbmPQvqBXyT2ifj247QXTUCgYEA5Sh4kZrVjEiBzeBM/F0BgGiw/TCxJ7c4WzfdYOXZZhV4fkqE/Qa6WjBPJNAhtXZVtPe2rgKmwAEpVxHCnghnLkNLHj0B5IBP8V7BXmm1hPqwFo5TcBAqgUYuI/ZLDlLQJp2f1G76aIu9IzVxRoSd4LJz/28PDL9Os8gROP6vVGUCgYEA+du3n87mSDGsrOKnQORGQhxT0vwYJEyRpP4njHQ7h+lXjQGGuqR/p3rkZykc6e138m7gKVZZdLbvOSCcNAsVaT/kWKfG9lKqKvVL/axOV7En77HmBeml27RmEZ7oySym0ZBbbqxaFML+82uMP5xfohAFBWa0LmYmMsm0K8D8xlMCgYEAq4bakKpj0+hl+NM+7Ns1B4fViv8Ka57yOR0cwK3rR0Uk9usSlk6V6HImm3iK8sgLqTSN8bwcUrXL2td5ZE8H5JIMRSsHIqGEtTfm56OaclouugN4ovYGytLcMKDnV2ZXVcBAZYNYPi7yuMsE6fLUNd99giIAEtuTrnA/q/i/Bh0CgYEA9+rvtH4TOScw8wqicl0O6aI5+mtxePMQwOn+S/s45o699IfDK4b1szTZVRMSQXsDPWaOvfWUJZ8ulzyoQWuN/zUKWn1/igJUHvPuRvKleZWqzsdyOgOwMuQ5Mtq+mH7Zt67JSnNxnpAtcVMRgjyjF6dVlBpoRnHNDS/eultvdUkCgYEAgykFWG76/DqZSL01/O6cw/6Mvqor0HdrMtOFr8MZnDBxyZpVApQob8k+Y8LSg2xaZCC1Y4GcP6CrlhAaI1jSKJKsHdGmjEFDUTte3zGsq3YKNmbh15VsK2KCBxD9Kd8oIqNweY9Z+WfTytnU4RFKzkxFT5dRsQlx2kDLNP8lbaY='
            let pub1 = 'MIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBsdsVMpCNOhURl5ZcvIL6tUUtuqljCIvk0w/d0Qoqq4DylyUViCi/nEobWQg/MJRPIiQ8matncdaWNAoxE4XTPF8Bn1Om4HY8fqQvuLChLVF5AzWW7wsLr0tvkN+nz7338HK7uWd3diJMzjXZbjF1nvlwCHZ3BHAiarnygHE33Oj/xFs='
            let pri1 = 'MIHuAgEAMBAGByqGSM49AgEGBSuBBAAjBIHWMIHTAgEBBEIAhiTp7VQaVK20gTMsJDimzcY9SswWOdJJK/AObOdyOkckomcGM+Mx+Af57bv+5hvmO05kFloPDLxTWNVwwY0AqCihgYkDgYYABAGx2xUykI06FRGXlly8gvq1RS26qWMIi+TTD93RCiqrgPKXJRWIKL+cShtZCD8wlE8iJDyZq2dx1pY0CjEThdM8XwGfU6bgdjx+pC+4sKEtUXkDNZbvCwuvS2+Q36fPvffwcru5Z3d2IkzONdluMXWe+XAIdncEcCJqufKAcTfc6P/EWw=='

            try {
                // 1-1. random
                log("random: " + formatBytes(window.random(16)), "#569cd6");

                // 1-2. sha3
                log("SHA3-256: " + formatBytes(window.sha3256(new Uint8Array(0))), "#569cd6");
                log("SHA3-512: " + formatBytes(window.sha3512(new Uint8Array(0))), "#569cd6");

                // 1-3. pbkdf2, argon2
                log("PBKDF2: " + formatBytes(await window.pbkdf2("0000", "0000000000000000")), "#569cd6");
                let t = await window.argon2Hash("0000", "0000000000000000");
                log("Argon2: " + t, "#569cd6");
                log(await window.argon2Verify(t, "0000"), "#569cd6");

                // 1-4. genkey
                log("genkey: " + formatBytes(await window.genkey("0000000000000000", "test", 16)), "#569cd6");

            } catch (e) {
                console.error(e);
                log(`ERROR: ${e.message}`, "#f44336");
                log(e.stack, "gray");
            }
        }
    </script>
</body>
</html>
